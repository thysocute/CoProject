require.define({
  "ep_etherpad-lite/static/js/scroll.js": function (require, exports, module) {
function Scroll(t){this.scrollSettings=parent.parent.clientVars.scrollWhenFocusLineIsOutOfViewport,this.outerWin=t,this.doc=this.outerWin.document,this.rootDocument=parent.parent.document}var caretPosition=require("/caretPosition");Scroll.prototype.scrollWhenCaretIsInTheLastLineOfViewportWhenNecessary=function(t,e,o){var r=this.scrollSettings.scrollWhenCaretIsInTheLastLineOfViewport;if(r){var i=t.selStart[0]!==t.selEnd[0];if(e&&!i&&this._isCaretAtTheBottomOfViewport(t)){var n=this._getPixelsRelativeToPercentageOfViewport(o);this._scrollYPage(n)}}},Scroll.prototype.scrollWhenPressArrowKeys=function(t,e,o){if(this._arrowUpWasPressedInTheFirstLineOfTheViewport(t,e)){var r=this._getPixelsToScrollWhenUserPressesArrowUp(o);this._scrollYPageWithoutAnimation(-r)}else this.scrollNodeVerticallyIntoView(e,o)},Scroll.prototype._isCaretAtTheBottomOfViewport=function(t){var e=t.selStart[0],o=e+1,r=caretPosition.getNextVisibleLine(o,t),i=this._isLinePartiallyVisibleOnViewport(e,t),n=this._isLinePartiallyVisibleOnViewport(r,t);if(i||n){var l=caretPosition.getPosition(),s=this._getViewPortTopBottom().bottom,c=caretPosition.getBottomOfNextBrowserLine(l,t),a=c>s;return a}return!1},Scroll.prototype._isLinePartiallyVisibleOnViewport=function(t,e){var o=e.lines.atIndex(t),r=this._getLineEntryTopBottom(o),i=r.top,n=r.bottom,l=this._getViewPortTopBottom(),s=l.bottom,c=l.top,a=s>i,p=n>=s,h=i>=c,g=s>=i,u=s>=n,f=n>=c;return a&&p||h&&g||u&&f},Scroll.prototype._getViewPortTopBottom=function(){var t=this.getScrollY(),e=this.doc,o=e.documentElement.clientHeight,r=this._getEditorPositionTop()+this._getPaddingTopAddedWhenPageViewIsEnable();return{top:t,bottom:t+o-r}},Scroll.prototype._getEditorPositionTop=function(){var t=parent.document.getElementsByTagName("iframe"),e=t[0].offsetTop;return e},Scroll.prototype._getPaddingTopAddedWhenPageViewIsEnable=function(){var t=this.rootDocument.getElementsByName("ace_outer"),e=parseInt($(t).css("padding-top"));return e},Scroll.prototype._getScrollXY=function(){var t=this.outerWin,e=this.doc;if("number"==typeof t.pageYOffset)return{x:t.pageXOffset,y:t.pageYOffset};var o=e.documentElement;return o&&"number"==typeof o.scrollTop?{x:o.scrollLeft,y:o.scrollTop}:void 0},Scroll.prototype.getScrollX=function(){return this._getScrollXY().x},Scroll.prototype.getScrollY=function(){return this._getScrollXY().y},Scroll.prototype.setScrollX=function(t){this.outerWin.scrollTo(t,this.getScrollY())},Scroll.prototype.setScrollY=function(t){this.outerWin.scrollTo(this.getScrollX(),t)},Scroll.prototype.setScrollXY=function(t,e){this.outerWin.scrollTo(t,e)},Scroll.prototype._isCaretAtTheTopOfViewport=function(t){var e=t.selStart[0],o=e-1,r=caretPosition.getPreviousVisibleLine(o,t),i=this._isLinePartiallyVisibleOnViewport(e,t),n=this._isLinePartiallyVisibleOnViewport(r,t);if(i||n){var l=caretPosition.getPosition(),s=this._getViewPortTopBottom(),c=s.top,a=s.bottom,p=l.bottom>=c,h=l.top<a,g=p&&h;if(g){var u=caretPosition.getPositionTopOfPreviousBrowserLine(l,t),f=c>u;return f}}return!1},Scroll.prototype._getPixelsRelativeToPercentageOfViewport=function(t,e){var o=0,r=this._getPercentageToScroll(e);return r>0&&1>=r&&(o=parseInt(t*r)),o},Scroll.prototype._getPercentageToScroll=function(t){var e=this.scrollSettings.percentage.editionBelowViewport;return t&&(e=this.scrollSettings.percentage.editionAboveViewport),e},Scroll.prototype._getPixelsToScrollWhenUserPressesArrowUp=function(t){var e=0,o=this.scrollSettings.percentageToScrollWhenUserPressesArrowUp;return o>0&&1>=o&&(e=parseInt(t*o)),e},Scroll.prototype._scrollYPage=function(t){var e=this.scrollSettings.duration;e?this._scrollYPageWithAnimation(t,e):this._scrollYPageWithoutAnimation(t)},Scroll.prototype._scrollYPageWithoutAnimation=function(t){this.outerWin.scrollBy(0,t)},Scroll.prototype._scrollYPageWithAnimation=function(t,e){var o=this.doc.getElementById("outerdocbody"),r=$(o);this._triggerScrollWithAnimation(r,t,e);var i=r.parent();this._triggerScrollWithAnimation(i,t,e)},Scroll.prototype._triggerScrollWithAnimation=function(t,e,o){t.stop("scrollanimation"),t.animate({scrollTop:"+="+e},{duration:o,queue:"scrollanimation"}).dequeue("scrollanimation")},Scroll.prototype.scrollNodeVerticallyIntoView=function(t,e){var o=this._getViewPortTopBottom(),r=(this._partOfRepLineIsOutOfViewport(o,t),caretPosition.getPosition());if(r){var i=r.top-o.top,n=o.bottom-r.bottom,l=0>i,s=0>n;if(l){var c=i-this._getPixelsRelativeToPercentageOfViewport(e,!0);this._scrollYPage(c)}else if(s){var c=-n+this._getPixelsRelativeToPercentageOfViewport(e);this._scrollYPage(c)}else this.scrollWhenCaretIsInTheLastLineOfViewportWhenNecessary(t,!0,e)}},Scroll.prototype._partOfRepLineIsOutOfViewport=function(t,e){var o=e.selFocusAtStart?e.selStart[0]:e.selEnd[0],r=e.lines.atIndex(o),i=this._getLineEntryTopBottom(r),n=i.top<t.top,l=i.bottom>t.bottom;return l||n},Scroll.prototype._getLineEntryTopBottom=function(t,e){var o=t.lineNode,r=o.offsetTop,i=o.offsetHeight,n=e||{};return n.top=r,n.bottom=r+i,n},Scroll.prototype._arrowUpWasPressedInTheFirstLineOfTheViewport=function(t,e){var o=this.scrollSettings.percentageToScrollWhenUserPressesArrowUp;return o&&t&&this._isCaretAtTheTopOfViewport(e)},Scroll.prototype.getVisibleLineRange=function(t){var e=this._getViewPortTopBottom(),o={},r=this,i=t.lines.search(function(t){return r._getLineEntryTopBottom(t,o).bottom>e.top}),n=t.lines.search(function(t){return r._getLineEntryTopBottom(t,o).top>=e.bottom});return i>n&&(n=i),[i,n-1]},Scroll.prototype.getVisibleCharRange=function(t){var e=this.getVisibleLineRange(t);return[t.lines.offsetOfIndex(e[0]),t.lines.offsetOfIndex(e[1])]},exports.init=function(t){return new Scroll(t)};
}
});
